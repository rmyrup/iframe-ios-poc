function debounce(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function generateId(){return"undefined"==typeof generateId.count&&(generateId.count=1),generateId.count++}function getSlide(a){a=parseInt(a,10);var b=$.grep(slideInfo,function(b){return b.identifier===a});return b[0]}function getIndex(a){a=parseInt(a,10);for(var b=0;b<slideInfo.length;b++)if(slideInfo[b].identifier===a)return b;return-1}function sendData(){var a={confirm:askConfirm};a.layout=currentLayout,widgetSize?a.widgetSize=widgetSize:a.widgetSize="100%",orientation?a.orientation=orientation:a.orientation="horizontal",s9.initialParams.labelFontFamily?a.labelFontFamily=s9.initialParams.labelFontFamily:a.labelFontFamily="Arial, sans-serif",s9.initialParams.labelFontSize?a.labelFontSize=s9.initialParams.labelFontSize:a.labelFontSize="14px",s9.initialParams.captionLineHeight?a.captionLineHeight=s9.initialParams.captionLineHeight:a.captionLineHeight="normal",s9.initialParams.captionFontFamily?a.captionFontFamily=s9.initialParams.captionFontFamily:a.captionFontFamily="Arial, sans-serif",s9.initialParams.captionFontSize?a.captionFontSize=s9.initialParams.captionFontSize:a.captionFontSize="14px",scale>0&&scale<=1?a.scale=scale:a.scale=1;for(var b=1;;){if(!slideInfo[b-1])break;a["image"+b]=slideInfo[b-1].imgsrc,a["label"+b]=slideInfo[b-1].label,a["caption"+b]=slideInfo[b-1].caption,a["slideShortDescription"+b]=slideInfo[b-1].slideShortDescription,a["slideLongDescription"+b]=slideInfo[b-1].slideLongDescription,slideInfo[b-1].hasOwnProperty("overlays")&&(a["overlays"+b]=JSON.stringify(slideInfo[b-1].overlays)),"undefined"!=typeof slideInfo[b-1].scale&&(a["scale"+b]=slideInfo[b-1].scale),a["imageWidth"+b]=slideInfo[b-1].imageWidth>=0?slideInfo[b-1].imageWidth:null,a["imageHeight"+b]=slideInfo[b-1].imageHeight>=0?slideInfo[b-1].imageHeight:null,b++}var c,d,e=$("input:checkbox");for(b=0;b<e.length;b++)c=e[b].id,d=$(e[b]).is(":checked")?"true":"false",a[c]=d;var f=$("select");for(b=0;b<f.length;b++)c=f[b].name,d=f[b].value,a[c]=d;mhe.updateConfigFile({json:a})}function displaySliderSize(a){return 100*a}function buildRadioButtonMenu(){var a="",b=getLayoutKeys();a+="<label>Type Placement</label><br/>",a+='<form action="">',a+='<fieldset style="border:0;line-height:150%">';for(var c in b)a+='<input type="radio" name="layoutchoice" value='+b[c].name+" /> "+b[c].desc+" <br/>";a+="</fieldset>",a+="</form>",$("#radio_menu").html(a)}function setLayoutType(a){var b=$("input:radio[name=layoutchoice]");b.filter("[value="+a+"]").prop("checked",!0)}function initSlideInfo(){if(s9)if(s9.initialParams&&s9.initialParams.configFile){var a=s9.initialParams.configFile;$.ajax({url:a,dataType:"json",success:function(a){var b,c,d,e,f=a.json,g=1;for(currentLayout=f.layout?f.layout:"LbotCbot",buildRadioButtonMenu(),setLayoutType(currentLayout);;){var h=new Image;if(imgsrc=f["image"+g],!imgsrc)break;h.src=imgsrc,h.className="fullImage";var i,j,k=f["label"+g],l=f["caption"+g];d="undefined"!=typeof f["slideShortDescription"+g]?f["slideShortDescription"+g]:"",e="undefined"!=typeof f["slideLongDescription"+g]?f["slideLongDescription"+g]:"",i=f["overlays"+g]?JSON.parse(f["overlays"+g]):[],j="undefined"!=typeof f["scale"+g]?f["scale"+g]:1,b=f["imageWidth"+g]>=0?f["imageWidth"+g]:null,c=f["imageHeight"+g]>=0?f["imageHeight"+g]:null;var m=generateId();slideInfo.push({image:h,imgsrc:imgsrc,label:k,caption:l,overlays:i,originalIndex:g,identifier:m,scale:j,imageWidth:b,imageHeight:c,slideShortDescription:d,slideLongDescription:e}),g++}"undefined"!=typeof f.widgetSize?widgetSize=f.widgetSize:widgetSize="100%",$("#widgetSize").val(widgetSize),f.orientation?orientation=f.orientation:orientation="horizontal",$("#orientation").val(orientation),f.scale?scale=f.scale||1:scale=1,$("#scale").val(displaySliderSize(scale)),$(document).trigger("contentChanged")},error:function(a,b,c){}})}else if(s9.initialParams&&!s9.initialParams.configFile){currentLayout="LbotCbot",buildRadioButtonMenu(),setLayoutType(currentLayout);for(var b,c,d,e,f,g=1;;){var h=new Image;if(imgsrc=s9.initialParams["image"+g],!imgsrc)break;h.src=imgsrc,h.className="fullImage";var i,j=s9.initialParams["label"+g],k=s9.initialParams["caption"+g];b="undefined"!=typeof JSONObject["slideShortDescription"+g]?JSONObject["slideShortDescription"+g]:"",c="undefined"!=typeof JSONObject["slideLongDescription"+g]?JSONObject["slideLongDescription"+g]:"",i=s9.initialParams["overlays"+g]?JSON.parse(s9.initialParams["overlays"+g]):[],f="undefined"!=typeof s9.initialParams["scale"+g]?s9.initialParams["scale"+g]:1,d=s9.initialParams["imageWidth"+g]>=0?s9.initialParams["imageWidth"+g]:null,e=s9.initialParams["imageHeight"+g]>=0?s9.initialParams["imageHeight"+g]:null;var l=generateId();slideInfo.push({image:h,imgsrc:imgsrc,label:j,caption:k,overlays:i,originalIndex:g,identifier:l,scale:f,imageWidth:d,imageHeight:e,slideShortDescription:b,slideLongDescription:c}),g++}"undefined"!=typeof s9.initialParams.widgetSize?widgetSize=s9.initialParams.widgetSize:widgetSize="100%",s9.initialParams.orientation?($("#orientation[name=orientation]").val(s9.initialParams.orientation),orientation=s9.initialParams.orientation):($("#orientation[name=orientation]").val("horizontal"),orientation="horizontal"),s9.initialParams.scale?scale=s9.initialParams.scale||1:scale=1,$("#scale").val(displaySliderSize(scale)),$(document).trigger("contentChanged")}}function convertSliderSize(a){if(a>=10&&a<=100)return a/100}function showPreview(){$(".preview").css({position:"relative",left:"auto"})}function hidePreview(){$(".preview").css({position:"absolute",left:"-10000px"})}function drawThumbnails(){var a=$("#slidelist-template").html().replace(/<\!\[CDATA\[|\]\]>/g,""),b=Handlebars.compile(a),c={slideData:slideInfo},d=document.querySelector(".mediaContent");d.innerHTML=b(c),$(".panel").imagesLoaded(function(){$(".nav-slide img").each(function(){this.naturalWidth<$(this).parent().width()&&$(this).css({width:this.naturalWidth,height:"auto",display:"inherit","margin-left":"auto","margin-right":"auto"})})})}function toggleWorkspace(){var a=$(".preview").css("left");"-10000px"===a?showPreview():hidePreview(),$(".upload").toggle()}function displayImageSettings(a){var b=getSlide(a);imagesLoaded(".wrapper-"+b.identifier+" img.fullImage",function(){$("#image-settings").empty();var a,c=$(".wrapper-"+b.identifier+" img.fullImage").width(),d=new Image;d.src=b.imgsrc;var e=Math.round(c/d.naturalWidth*100);e>100&&(e=100),a="undefined"==typeof b.scale?e:Math.round(100*b.scale);var f='<div style="margin-top: 20px;"><label for="imageScale">Scale %</label><input name="imageScale" type="text" value="'+a+'" data-name="imageScale" data-id="'+b.identifier+'"><button data-name="imageScale" data-id="'+b.identifier+'" style="display: none;">Set</button><span id="imageScaleMax"></span></div>';$("#image-settings").append(f)})}function displayOverlays(a){$(".overlay").remove();var b=getSlide(a);if(b.hasOwnProperty("overlays"))for(var c=0;c<b.overlays.length;c++){var d='<div class="draggable overlay overlays'+b.identifier+'" data-id="'+c+'" style="padding:1%;top: '+b.overlays[c].overlayPositionTop+"%; left: "+b.overlays[c].overlayPositionLeft+"%; position: absolute; z-index: "+b.identifier+'; opacity: 1;"><div class="handle" style="position: absolute;top: -7px;left: -7px;cursor: pointer;z-index: 1000;"><img src="img/handle.png"></div>'+b.overlays[c].overlayContent+"</div>";$("#preview-image .wrapper-"+b.identifier).append(d),$(".draggable").draggable({handle:".handle",containment:"parent",stop:function(){var a=$(this).position(),c=$(this).data("id"),d=a.left,e=a.top,f=Math.round(100*d/$("#preview-image").width()),g=Math.round(100*e/$("#preview-image").height());b.overlays[c].overlayPositionLeft=f,b.overlays[c].overlayPositionTop=g,sendData()}})}}function displayImageDescriptionEditors(a){$("#extraAccessibilityInfo").empty();var b=getSlide(a);if("img/blank.svg"!==b.imgsrc){var c=$("<div/>");c.addClass("form-group").append('<label for="slideShortDescription">Short Description</label><input id="slideShortDescription" type="text" value="'+b.slideShortDescription+'" class="form-control" data-id="'+a+'"/>');var d=$("<div/>");d.addClass("form-group").append('<label for="slideLongDescription">Long Description</label><textarea id="slideLongDescription" class="form-control" data-id="'+a+'">'+b.slideLongDescription+"</textarea>"),$("#extraAccessibilityInfo").append("<fieldset><legend>Accessibility</legend>"),$("#extraAccessibilityInfo > fieldset").append(c),$("#extraAccessibilityInfo > fieldset").append(d)}}function displayOverlayEditors(a){$(".overlayEdit").remove();var b=getSlide(a);if(b.hasOwnProperty("overlays"))for(var c=0;c<b.overlays.length;c++){var d='<div class="overlayEdit clearfix" data-name="overlay" data-id="'+c+'"><label for="overlayContent">Overlay Text</label><br /><div class="ckeditor" contenteditable="true" name="overlayContent" data-name="overlayContent" data-id="'+c+'" style="width: 100%; min-height: 50px; background-color: white;">'+b.overlays[c].overlayContent+'</div><button type="button" class="button icon-trash"></button><div class="button icon icon-arrows"></div><br /></div>';$("#overlays").append(d)}addCKEditor(),$("#edit-area > #overlays").sortable({items:".overlayEdit",containment:"parent",handle:".icon-arrows",update:function(a,b){var c=$(this).sortable("toArray",{attribute:"data-id"}),d=c.map(function(a){return parseInt(a,10)}),e=getSlide(currentSlide),f=function(a,b){return b.map(function(b){return a[b]})},g=f(e.overlays,d);e.overlays=g,sendData(),$("#overlays .overlayEdit").each(function(a,b){$(this).attr("data-id",a)}),displayOverlays(currentSlide)}})}function removeCKEditor(){if("undefined"!=typeof CKEDITOR)for(var a in CKEDITOR.instances){var b=CKEDITOR.instances[a];b.destroy()}}function addCKEditor(){removeCKEditor();var a={extraPlugins:"widget,dialog,clipboard,lineutils,mathjax,mheliststyle,menu,contextmenu",toolbar:[["FontSize"],["Bold","Italic","Underline"],["TextColor","BGColor"],{name:"paragraph",groups:["list","align"],items:["NumberedList","BulletedList","mheliststyle","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},["Mathjax"]],font_defaultLabel:"Proxima Nova",floatSpacePinnedOffsetY:200,fontSize_defaultLabel:"14",autoParagraph:!0,enterMode:CKEDITOR.ENTER_P,mathJaxLib:"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},b={extraPlugins:"widget,dialog,clipboard,lineutils,mathjax",toolbar:[["FontSize"],["Bold","Italic","Underline"],["TextColor","BGColor"],["Mathjax"]],font_defaultLabel:"Proxima Nova",floatSpacePinnedOffsetY:200,fontSize_defaultLabel:"14",mathJaxLib:"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"};$("#preview-area").imagesLoaded(function(){function c(a,b,c,d){var e,f=c,g=b,h=$(g).attr("data-name");if("label"===h||"caption"===h)e=slideInfo[currentSlide-1][h],slideInfo[currentSlide-1][h]=f,sendData();else if("overlayContent"===h){var i=parseInt($(g).attr("data-id"),10);e=slideInfo[currentSlide-1].overlays[i][h],slideInfo[currentSlide-1].overlays[i][h]=f,displayOverlays(slideInfo[currentSlide-1].identifier),myMathJaxTypeset(),sendData()}}mhe.configureCKEditor({ckeditorConfig:b,options:{wiris:!0,editorSelector:".ckeditor.item-text"}}),mhe.configureCKEditor({ckeditorConfig:a,options:{wiris:!0,editorSelector:'.ckeditor[name="overlayContent"]'}}),mhe.ckeditorInstallHandlers({changeCallback:c}),CKEDITOR.on("instanceReady",function(a){a.removeListener(),$.each(CKEDITOR.instances,function(a,b){var c,d=b.element.$,e=$(d).attr("data-name");if("overlayContent"===e&&slideInfo[currentSlide-1].hasOwnProperty("overlays")){var f=parseInt($(d).attr("data-id"),10);c=slideInfo[currentSlide-1].overlays[f][e]}else c=slideInfo[currentSlide-1][e];b.setData(c)})})})}function selectSlide(a){$(a).hasClass("nav-slide")||(a=$(".nav-slide")[0]);var b=$(".nav-slide");b.removeClass("active"),$(a).addClass("active");var c=$(a).closest("li"),d=c.attr("data-index"),e=c.data("id");currentSlide=parseInt(d,10);var f=getSlide(e);if(f){var g=$(".wrapper-"+f.identifier);if(g.stop(!0,!0).animate({opacity:1,duration:370}),lastStop>0&&lastStop<=slideInfo.length){var h=$(".wrapper-"+slideInfo[Math.round(lastStop)-1].identifier);g[0]!==h[0]&&h.stop(!0,!0).animate({opacity:0,duration:370})}lastStop=d,$("#slider").slider("option","animate",!1),$("#slider").slider("value",d),$("#slider").slider("option","animate",!0),$(".overlay").css({opacity:0}),setTimeout(function(){myMathJaxTypeset()},750),imagesLoaded(".wrapper-"+f.identifier,function(){displayImageSettings(f.identifier),displayOverlays(f.identifier),displayOverlayEditors(f.identifier),displayImageDescriptionEditors(f.identifier);var a=$(".preview").css("left");"-10000px"===a&&toggleWorkspace()})}}function orientThumbnails(){var a=$(".actual-image");$(a).each(function(a){var b=slideInfo[a].image;b&&($(b).load(function(a,b){return function(){var c=b.naturalHeight>b.naturalWidth;c?($(a).removeClass("landscape"),$(a).addClass("portrait")):($(a).removeClass("portrait"),$(a).addClass("landscape"))}}(this,b)),b.complete&&$(b).load())})}function renumberThumbnails(){var a=0,b=document.querySelectorAll("#slides ol li");Array.prototype.forEach.call(b,function(b,c){var d=c+1,e=b.getAttribute("data-index");parseInt(e,10)===parseInt(currentSlide,10)&&(a=d),b.setAttribute("data-index",d);var f=$(b).find(".actual-image");$(f).removeClass("image"+e).addClass("image"+d)}),currentSlide=a}function loadMediaTab(){drawThumbnails(),currentSlide>0&&selectSlide($(".nav-slide")[currentSlide-1]),$(".nav-slide .actual-image").each(function(){$(this).load(function(){$(this).hide(),$(this).fadeIn(400)})}),orientThumbnails(),$(".sortableThumbs").sortable({update:function(a,b){var c=b.item.attr("data-index");renumberThumbnails();var d=b.item.attr("data-index"),e=slideInfo.splice(c-1,1);slideInfo.splice(d-1,0,e[0]);for(var f=1;f<slideInfo.length+1;f++)slideInfo[f-1].originalIndex=f;sendData();var g=$(".nav-slide.active").closest("li").attr("data-id");selectSlide($(".nav-slide.slide-"+g))},forcePlaceholderSize:!0,placeholder:"sortable-placeholder",scroll:!1})}function drawDeck(){for(var a=0;a<slideInfo.length;a++){var b=$("<div/>");b.addClass("image-wrapper"),b.addClass("wrapper-"+slideInfo[a].identifier),b.append(slideInfo[a].image),$("#preview-image").append(b)}}function setPreviewSize(){$("#preview-image").css({height:"250px"});var a=!1;$(slideInfo).each(function(){var b;b="undefined"!=typeof this.scale?this.scale:1;var c=this.image.src,d=this.identifier;$(this.image).load(function(b,c,d){var e=new Image;e.src=c;var f=e.naturalHeight,g=e.naturalWidth,h=getSlide(d);h.imageWidth!==g&&(h.imageWidth=g,a=!0),h.imageHeight!==f&&(h.imageHeight=f,a=!0),a&&sendData(),f*=b,g*=b,imageNaturalHeights.push(f),imageNaturalWidths.push(g)}(b,c,d)),this.image&&this.image.complete&&$(this.image).load()}),$(".workspace").imagesLoaded(function(){for(var a=0,b=0,c=0;c<imageNaturalHeights.length;c++)(imageNaturalHeights[c]>a||imageNaturalHeights[c]===a&&imageNaturalWidths[c]>b)&&(a=imageNaturalHeights[c],b=imageNaturalWidths[c]);var d,e=Math.max.apply(null,imageNaturalWidths),f=e/b;d=f<=1?a*f:a,$("#preview-container").css({width:e+"px"}),$("#preview-image").css({width:e+"px",height:d+"px"}),$(".image-wrapper .fullImage").each(function(a,b){var c,f=e;c="undefined"!=typeof slideInfo[a].scale&&1!==slideInfo[a].scale?slideInfo[a].scale:1;var g=this.naturalHeight,h=this.naturalWidth;g*=c,h*=c;var i=f/h,j=g*i,k=h*i;h<=f&&g<=d?($(b).parent().css({width:h+"px",height:g+"px",display:"inherit",left:(f-h)/2+"px",top:(d-g)/2+"px"}),$(this).css({width:h+"px",height:g+"px",display:"inherit","margin-left":"auto","margin-right":"auto"})):h<=f&&j>d?($(b).parent().css({width:d/g*h+"px",height:d+"px",display:"inherit",left:"0px",top:"0px"}),$(this).css({width:d/g*h+"px",height:d+"px",display:"inherit","margin-left":"auto","margin-right":"auto"})):k>=f&&j<=d?($(b).parent().css({width:f+"px",height:j+"px",display:"inherit",left:"0px",top:(d-j)/2+"px"}),$(this).css({width:f+"px",height:j+"px",display:"inherit","margin-left":"auto","margin-right":"auto"})):k<=f&&j>d&&($(b).parent().css({width:d/j*k+"px",height:d+"px",display:"inherit",left:(f-d/j*k)/2+"px",top:"0px"}),$(this).css({width:d/j*k+"px",height:d+"px",display:"inherit","margin-left":"auto","margin-right":"auto"}))})})}function setSliderTicks(){var a,b=$("#slider"),c=b.slider("option","max");a=c>1?100/(c-1):50,b.find(".ui-slider-tick-mark").remove();for(var d=0;d<c;d++)$('<span class="ui-slider-tick-mark"></span>').css("left",a*d+"%").appendTo(b)}function clearGhosts(a,b,c){for(var d=0;d<slideInfo.length;d++)if(d!==a&&d!==b){var e=$(".wrapper-"+slideInfo[d].identifier);c?e.animate({opacity:0,duration:370}):e.css({opacity:0})}}function buildSlider(){$("#slider").slider({animate:!0,value:1,min:1,max:slideInfo.length,step:.01,slide:function(a,b){var c=b.value,d=Math.floor(c),e=c-d,f=Math.floor(c),g=Math.ceil(c);if(lastStop!==f&&lastStop!==g&&lastStop>0&&lastStop<=slideInfo.length){var h=$(".wrapper-"+slideInfo[lastStop-1].identifier);h.css("opacity",0)}var i=$(".wrapper-"+slideInfo[d-1].identifier),j=d<slideInfo.length?$(".wrapper-"+slideInfo[d].identifier):[];b.value>last&&($(i).css("opacity",1-e),$(j).css("opacity",e)),b.value<last&&($(i).css("opacity",1-e),$(j).css("opacity",e)),Math.floor(last)!==d&&clearGhosts(f-1,g-1),last=b.value},stop:function(a,b){var c=Math.round(b.value);$("#slider").slider("value",c),clearGhosts(c-1,void 0,!0);var d=slideInfo[c-1];currentSlide=c,selectSlide($(".nav-slide")[currentSlide-1]);var e=$(".nav-slide.slide-"+d.identifier),f=$(".wrapper-"+d.identifier);$(f).stop(!0,!0).animate({opacity:1,duration:370}),$(".nav-slide").removeClass("active"),e.addClass("active"),last=c,lastStop=c}})}function initSlider(){buildSlider(),setSliderTicks()}function onLoaded(){initSlider(),loadMediaTab(),$(".panel").imagesLoaded(function(){drawDeck(),setPreviewSize(),slideInfo.length>0?(currentSlide=1,showPreview(),$(".upload").hide(),selectSlide($(".nav-slide")[0])):(hidePreview(),$(".upload").show())})}function clickAdd(){$("#image-uploader").click()}function clickReplace(a){$("#image-replacer").data("id",a),$("#image-replacer").click()}function deleteSlide(a){var b=$("li.slide-"+a)[0],c=getIndex(a);if(c>-1&&($(slideInfo[c].image).closest(".image-wrapper").remove(),slideInfo.splice(c,1),sendData()),b){var d=$(b).attr("data-index"),e=$(".nav-slide"),f=e[d],g=e[d-2];$(b).animate({opacity:0},{duration:50}).slideUp(100,function(){b.parentNode.removeChild(b),$("#slider").slider("option","max",slideInfo.length);var a=d===currentSlide;renumberThumbnails(),setSliderTicks(),a?f?selectSlide(f):g?selectSlide(g):toggleWorkspace():$("#slider").slider("value",currentSlide),0===slideInfo.length&&(currentSlide=0),setPreviewSize()})}}function confirmDelete(a){var b=$(".overlay-mask"),c=$(".dialog-box");c.show(),b.addClass("overlay-mask-visible");var d=$(".confirmDelete"),e=$(".cancelDelete");d.on("click",function(){deleteSlide(a),$(this).off("click"),$(".confirmation").hide(),$(".overlay-mask").removeClass("overlay-mask-visible")}),e.on("click",function(){$(d).off("click")})}function clickDelete(a){askConfirm?confirmDelete(a):deleteSlide(a)}function addSlide(){var a=slideInfo.length+1,b=generateId(),c=new Image;c.src="img/blank.svg",c.className="fullImage";var d={image:c,originalIndex:a,imgsrc:"img/blank.svg",identifier:b,label:"",caption:"",slideShortDescription:"",slideLongDescription:""};slideInfo.push(d),sendData(),loadMediaTab(),$("#preview-image").empty(),drawDeck(),$("#slider").slider("option","max",slideInfo.length),setSliderTicks(),setPreviewSize();var e=$(".nav-slide").length;slideInfo.length>0?(currentSlide=parseInt(e,10),showPreview(),$(".upload").hide(),setTimeout(function(){selectSlide($(".nav-slide.slide-"+currentSlide))},100)):(hidePreview(),$(".upload").show())}function duplicateSlide(a){var b=$(".nav-slide.active").closest("li").attr("data-index"),c=generateId(),d=$.extend(!0,{},getSlide(a)),e=new Image;e.src=d.imgsrc,e.className="fullImage",d.image=e,d.originalIndex=parseInt(b,10)+1,d.identifier=c;for(var f=0;f<slideInfo.length;f++)slideInfo[f].originalIndex>=parseInt(b,10)+1&&(slideInfo[f].originalIndex=parseInt(slideInfo[f].originalIndex,10)+1);slideInfo.splice(parseInt(b,10),0,d),sendData(),loadMediaTab(),$("#preview-image").empty(),drawDeck(),$("#slider").slider("option","max",slideInfo.length),setSliderTicks(),setPreviewSize(),slideInfo.length>0?(currentSlide=parseInt(b,10)+1,showPreview(),$(".upload").hide(),setTimeout(function(){selectSlide($(".nav-slide")[parseInt(b,10)])},1)):(hidePreview(),$(".upload").show())}function addOverlay(){var a,b=currentSlide-1;slideInfo[b].hasOwnProperty("overlays")?a=slideInfo[b].overlays.length:(slideInfo[b].overlays=[],a=0),slideInfo[b].overlays[a]={overlayContent:"",overlayPositionTop:5,overlayPositionLeft:2},displayOverlayEditors(currentSlide)}function deleteOverlay(a){slideInfo[currentSlide-1].overlays.splice(a,1),sendData(),selectSlide($(".nav-slide")[currentSlide-1])}function autoSize(a,b){var c=$(a).outerHeight(!0);if(a.scrollHeight>=150)return a.style.overflow="auto",void(b?$(a).animate({height:"150px"},{duration:200,easing:"linear",queue:!1}):a.style.height="150px");var d=$(a);d.html(a.html),d.addClass("item-clone"),$(a.parentNode).append(d[0]);var e=d[0].scrollHeight;e<c&&(e=c),b?$(a).animate({height:e.toString()+"px"},{duration:200,easing:"linear",queue:!1}):a.style.height=e.toString()+"px",d.remove()}function dragHover(a){a.stopPropagation(),a.preventDefault(),"dragover"===a.type?($(a.target).addClass("hovering"),$(".dragText").addClass("ready-text"),$(".dragText").text("Ready to Drop"),$(".upload-instructions .details").text("Drop your files at any time.")):($(a.target).removeClass("hovering"),$(".dragText").removeClass("ready-text"),$(".dragText").text("Click to Upload Images"),$(".upload-instructions .details").html("or drag and drop files from your desktop.<p/>* All images should have the same aspect ratio."))}function uploadHandler(a){for(var b=a.target.files||a.dataTransfer.files,c=0;c<b.length;c++){var d=b[c],e=$("#slide-partial").html().replace(/<\!\[CDATA\[|\]\]>/g,""),f=Handlebars.compile(e),g=slideInfo.length+1,h=generateId();slideInfo.push({image:void 0,imgsrc:"img/blank.svg",label:"",caption:"",originalIndex:g,identifier:h,slideShortDescription:"",slideLongDescription:""});var i=f({originalIndex:slideInfo.length,imgsrc:"img/blank.svg",identifier:h});$(".sortableThumbs").append(i);var j=$("<div/>");j.addClass("image-wrapper wrapper-"+h),j.append('<span class="load-'+h+' load-container"><span class="load-progress"></span></span>'),$("#preview-image").append(j),$("li.slide-"+h+" .nav-slide").append('<span class="load-'+h+' load-container"><span class="load-progress"></span></span>'),$("#slider").slider("option","max",slideInfo.length),setSliderTicks(),window.parent.postMessage({type:"asset",method:"image",payload:{data:d,id:h,progress:!0}},"*")}}function fileDrop(a){dragHover(a),uploadHandler(a)}function dragInit(){var a=new XMLHttpRequest;if(a.upload){var b=$(".drag-area")[0];b.addEventListener("dragover",dragHover,!1),b.addEventListener("dragleave",dragHover,!1),b.addEventListener("drop",fileDrop,!1),$(".upload-instructions .details").show()}}try{var iframe=window.frameElement,winParent=window.parent;$(winParent.document).ready(function(){var a=winParent.jQuery;a&&(a(iframe).trigger("iframeloading"),$(function(){a(iframe).trigger("iframeready")}))})}catch(a){}var myMathJaxTypeset=debounce(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub])},1e3),currentLayout="LbotCbot",currentSlide=0,slideInfo=[],askConfirm=function(){return!s9.initialParams.confirm||"true"===s9.initialParams.confirm}(),blankImage=new Image,last=0,lastStop=0,imageNaturalHeights=[],imageNaturalWidths=[];window.addEventListener("message",function(a){var b,c=a.data;if("asset"===c.type&&"image"===c.method&&c.payload){var d=c.payload;if(1===d.progress){if(d.path){var e=d.path;b=d.id;var f=new Image;f.src=e,f.className="fullImage";var g=getSlide(b);if(!g)return;var h=$("li.slide-"+b+" .actual-image");$(".load-"+b+" .load-progress").width("100%"),h.attr("src",e),h.imagesLoaded(function(){$(".load-"+b).fadeOut(400,function(){$(".load-"+b).remove(),h.fadeIn(400),g.image=f,g.imgsrc=e,sendData();var a=$(".wrapper-"+b);a.css({opacity:0}),a.empty().append(g.image),a.animate({opacity:1,duration:400}),displayOverlays(g.identifier),orientThumbnails(),setPreviewSize(),selectSlide($(".nav-slide.slide-"+b)),myMathJaxTypeset()}),$(this).off("load")}),renumberThumbnails()}}else{b=d.id;var i=100*d.progress;$(".load-"+b+" .load-progress").delay(1500).width(i+"%"),0===currentSlide&&selectSlide($(".nav-slide")[0])}}}),window.addEventListener("load",function(){window.File&&window.FileList&&window.FileReader&&dragInit(),$("#extraAccessibilityInfo").on("change",":input",function(a){var b=$(this).attr("data-id"),c=getSlide(b);c[$(this).attr("id")]=$(this).val(),sendData()}),$('input[type="radio"]').on("change",function(a){currentLayout=a.target.value}),$(".cancelDelete").click(function(){$(".confirmation").hide(),$(".overlay-mask").removeClass("overlay-mask-visible")}),$("#showDelConf").change(function(){askConfirm=!$(this).is(":checked"),sendData()}),$("body").on("click",".add-image",function(){clickAdd()}),$("body").on("click",".add-slide",function(){addSlide()}),$(".add-overlay").on("click",function(){addOverlay()}),$(".btn-delete").on("click",function(){return clickDelete(slideInfo[currentSlide-1].identifier),!1}),$("body").on("click",".btn-trash",function(a){var b=$(a.currentTarget).attr("data-id");return clickDelete(b),!1}),$(".btn-replace").on("click",function(){return clickReplace(slideInfo[currentSlide-1].identifier),!1}),$(".btn-duplicate").on("click",function(){return duplicateSlide(slideInfo[currentSlide-1].identifier),!1}),$(".drag-area").on("click",function(){clickAdd()}),$(".slide-caption").on("input paste",function(){autoSize(this,!0)}),$(".panel").on("click",".icon-trash",function(){return clickDelete($(this).closest("li").data("id")),!1}),$(".panel").on("click",".nav-slide",function(){selectSlide(this)}),$("#image-uploader").change(function(a){uploadHandler(a),$(this).val("")}),$("#image-replacer").change(function(){var a=document.getElementById("image-replacer").files[0],b=$(this).data("id"),c=getIndex(b);slideInfo[c].image=void 0,$("li.slide-"+b+" .actual-image").fadeOut(400),$("li.slide-"+b+" .nav-slide").append('<span class="load-'+b+' load-container"><span class="load-progress"></span></span>'),$(".wrapper-"+b).empty().append('<span class="load-'+b+' load-container"><span class="load-progress"></span></span>'),$(this).val(""),window.parent.postMessage({type:"asset",method:"image",payload:{data:a,id:b,progress:!0}},"*")}),$(".marker").on("click",function(){$(this).hasClass("expanded")?($("#settings").hide(),$(this).removeClass("expanded").addClass("contracted")):$(this).hasClass("contracted")&&($("#settings").show(),$(this).removeClass("contracted").addClass("expanded"))}),$("#settings :input").on("change",function(a){var b=$(a.currentTarget).attr("name");switch(b){case"widgetSize":widgetSize=$(a.currentTarget).val(),setPreviewSize();break;case"orientation":orientation=$(a.currentTarget).val();break;case"scale":scale=convertSliderSize($(a.currentTarget).val())}sendData()}),$(".content").delegate(".overlayEdit .icon-trash","click",function(a){return deleteOverlay($(a.currentTarget).closest("div").attr("data-id")),!1}),$(".content").delegate("#overlays input","keyup change",function(a){var b=$(a.currentTarget).attr("data-name");if("overlayContent"!==b){var c=$(a.currentTarget).attr("data-id"),d=$(a.currentTarget).val(),e=slideInfo[currentSlide-1].overlays[parseInt(c,10)][b];d!==e&&(slideInfo[currentSlide-1].overlays[parseInt(c,10)][b]=d,displayOverlays(slideInfo[currentSlide-1].identifier),sendData())}}),$(".content").on("dragend",".ckeditor",function(a){var b,c=$(a.currentTarget).ckeditorGet(),d=c.getData(),e=c.element.$,f=$(e).attr("data-name");if("label"===f||"caption"===f)b=slideInfo[currentSlide-1][f],d!==b&&(slideInfo[currentSlide-1][f]=d,sendData());else if("overlayContent"===f){var g=parseInt($(e).attr("data-id"),10);b=slideInfo[currentSlide-1].overlays[g][f],d!==b&&(slideInfo[currentSlide-1].overlays[g][f]=d,displayOverlays(slideInfo[currentSlide-1].identifier),myMathJaxTypeset(),sendData())}else alert("Shouldn't be here.")}),$(".content").on("keyup","#image-settings input",function(a){var b=$(a.currentTarget).attr("data-id");$('#image-settings button[data-id="'+b+'"]').show()}),$(".content").on("click","#image-settings button",function(a){var b=$(a.currentTarget).attr("data-id"),c=getSlide(b),d=$(a.currentTarget).attr("data-name");if("imageScale"===d){var e=$('#image-settings input[data-id="'+b+'"]').val();if(e>0&&e<=100){var f=e/100;c.scale=f,imageNaturalWidths=[],imageNaturalHeights=[],sendData(),$("#preview-image").empty(),drawDeck(),setPreviewSize(),selectSlide($(".nav-slide.slide-"+b)),displayOverlays(c.identifier)}else e>100?$("#imageScaleMax").text("Maximum: 100%"):$("#imageScaleMax").text("")}})}),$(window).resize(function(){setPreviewSize();var a=315,b=56,c=70,d=$(window).width(),e=d-a-b-c;$("#preview-container").css({width:d-a+"px"}),$("#preview-area").css({width:e+"px",overflow:"scroll"}),$("#edit-area").css({width:e+"px","margin-left":"76px"})}),$(document).ready(function(){$(document).on("contentChanged",function(){imagesLoaded(document.body,onLoaded)}),Handlebars.registerPartial("slide",$("#slide-partial").html().replace(/<\!\[CDATA\[|\]\]>/g,"")),CKEDITOR.disableAutoInline=!0,$(".workspace").on("scroll",function(a){var b=CKEDITOR.currentInstance;b&&(b.focusManager.blur("noDelay"),$(".ckeditor").blur())}),initSlideInfo(),blankImage.src="img/blank.svg",$(blankImage).addClass("load-placeholder"),$(window).trigger("resize")});